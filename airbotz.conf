# ==============================================================================================
# AIRBOTZ CONFIGURACIÓN DE REGLAS
# ----------------------------------------------------------------------------------------------
# umbral   = número de ocurrencias requeridas antes de aplicar la acción.
# ventana  = en segundos (p. ej. 300s = 5 min) → periodo en el que deben ocurrir los eventos.
# acción   = ban_temp | ban_perm | alert_only | log_only | watchlist
# duración = para ban_temp, en segundos (0 = no aplica)
# ==============================================================================================
# servicio   evento                                     umbral  ventana  acción          duración
# ==============================================================================================

# SSH / SFTP
sshd         ssh_failed_login                           5       300      ban_temp        600
sshd         ssh_invalid_user                           5       300      ban_temp        0
sshd         ssh_success_login                          1       0        log_only        0
sshd         ssh_disconnect_after_fail                  3       180      watchlist       0
sshd         ssh_connection_closed_authenticating       5       300      ban_temp        3600
sshd         ssh_pam_auth_failure                       5       300      ban_temp        900

# FTP
vsftpd       ftp_login_failed                           6       600      ban_temp        900
vsftpd       ftp_invalid_user                           3       300      ban_temp        900
vsftpd       ftp_login_success                          1       0        log_only        0
vsftpd       ftp_anonymous_access                       1       0        alert_only      0
vsftpd       ftp_idle_timeout                           2       600      watchlist       0
vsftpd       ftp_upload_detected                        1       0        log_only        0
vsftpd       ftp_download_detected                      1       0        log_only        0
vsftpd       ftp_suspicious_command                     2       300      ban_temp        1800
vsftpd       ftp_client_disconnected                    5       300      ban_temp        900

# HTTP / NGINX / Web  (detectables desde access.log / métricas de requests)
nginx        brute_force                                10      120      ban_temp        3600   # POSTs a endpoints de login (wp-login, /login) desde la misma IP
nginx        sql_injection_attempt                      10       60      ban_temp        0      # patrones en URI/qs/UA (union select, sleep(), %27, etc.)
nginx        xss_attempt                                10       60      ban_temp        3600   # <script, javascript:, onerror=, %3Cscript en URI/qs/UA
nginx        fuzzing_unique_uri                         30      300      ban_temp        7200   # N URIs únicas desde misma IP en ventana
nginx        fuzzing_404s                               50      300      ban_temp        7200   # muchos 404 desde misma IP en ventana
nginx        login_attempt                              10      120      log_only        0      # POST a login endpoints (no ban inmediato)
nginx        high_4xx_rate                              100     120      watchlist       0      # muchos 4xx en ventana (indicador de probing)
nginx        http_404_scanner                           20      120      ban_temp        3600   # múltiples paths distintos con 404
nginx        mass_scanner_detected                      100      60      ban_temp        3600   # gran cantidad de requests en 60s (rate)
nginx        sensitive_path_hit                         10       60      watchlist       3600   # hits a /.env, /wp-config.php, /phpmyadmin, etc.
nginx        suspicious_user_agent                      30      300      ban_temp        7200   # UAs típicos de scanners/bots (o UA vacío)
nginx        directory_traversal_attempt                10       60      ban_temp        3600   # ../ o %2e%2e en URI/qs
nginx        uncommon_http_method                       10      300      ban_temp        3600   # PUT/DELETE/TRACE/CONNECT/OPTIONS/PROPFIND desde IPs normales
nginx        excessive_500_errors                       50      300      watchlist       0      # muchos 5xx (problema o exploit)
nginx        suspicious_file_access                     15      300      ban_temp        7200   # acceso a .env, .bak, .sql, .git, phpinfo.php, etc.
nginx        suspicious_query_string                    20      300      ban_temp        7200   # patrones en querystring (union select, sleep(, load_file(, ' or '1'='1)
nginx        automated_scanner_user_agent               30      300      ban_temp        7200   # UAs de nikto, masscan, zgrab, etc.
nginx        excessive_post_requests                    100     120      ban_temp        3600   # muchos POST en ventana (posible brute / upload bot)
nginx        high_bandwidth_usage                       5000000 300      watchlist       0      # bytes_sent agregados > umbral en ventana (posible exfil)
nginx        suspicious_url_encoding                    15      300      ban_temp        7200   # muchos percent-encoding sospechosos (%00, %2e%2e, %3C)
nginx        rapid_data_exfiltration                    500000  300      ban_temp        3600   # bytes/requests altos en ventana (posible exfil)
ngginx       http_flood                                 1000     60      log_only        3600   # requests HTTP excesivos en corto tiempo (DDoS)
nginx        lfi_attempt                                10       60      log_only        3600
nginx        rce_attempt                                10       60      log_only        3600



# PF
pflog        pf_dropped_packet                           50      60      log_only        3600
pflog        pf_passed_packet                          1000      60      log_only        0
pflog        portscan                                    15      60      ban_temp        3600
pflog        syn_flood                                  100      60      ban_temp        3600
pflog        icmp_flood                                 100      60      ban_temp        3600
pflog        udp_flood                                 2000      60      ban_temp        3600
pflog        tcp_flood                                 2000      60      ban_temp        3600
pflog        fragmented_packet                           50      60      ban_temp        3600
pflog        unusual_port_activity                       20     300      watchlist       0
pflog        payload_anomaly                             10      60      ban_temp        3600

# minecraft
minecraft    mc_failed_login                            5       300      ban_temp        900
minecraft    mc_success_login                           1       0        log_only        0
minecraft    mc_chat_spam                              10       60      ban_temp        600
minecraft    mc_command_spam                           5       60      ban_temp        600
minecraft    mc_block_break_flood                      20       60      ban_temp        900
minecraft    mc_block_place_flood                      20       60      ban_temp        900
minecraft    mc_high_latency                           10       60      watchlist       0

# ==============================================================================================